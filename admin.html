<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Jordan Gargets Admin - Manage Products</title>
   <!-- Favicon -->
<link rel="icon" type="image/png" href="https://i.ibb.co/4gDndwPB/Flyerwiz-1769399915095.webp" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="https://i.ibb.co/4gDndwPB/Flyerwiz-1769399915095.webp" />
<link rel="shortcut icon" href="https://i.ibb.co/4gDndwPB/Flyerwiz-1769399915095.webp" />
<link rel="apple-touch-icon" sizes="180x180" href="https://i.ibb.co/4gDndwPB/Flyerwiz-1769399915095.webp" />
<link rel="manifest" href="/site.webmanifest" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f9f9f9;
      color: #333;
    }
    header {
      background: #f14c3a;
      color: white;
      padding: 20px;
      text-align: center;
      font-size: 1.8rem;
      font-weight: bold;
    }
    .container {
      max-width: 1200px;
      margin: 40px auto;
      padding: 20px;
    }
    .form-section {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      margin-bottom: 40px;
    }
    h2 {
      margin-bottom: 20px;
      color: #f14c3a;
    }
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 16px;
    }
    input, textarea, select {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 1rem;
    }
    textarea {
      min-height: 100px;
      resize: vertical;
    }
    button {
      background: #f14c3a;
      color: white;
      border: none;
      padding: 14px 24px;
      border-radius: 6px;
      font-size: 1.1rem;
      cursor: pointer;
      margin-top: 20px;
    }
    button:hover {
      background: #d83a2a;
    }
    .products-table {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 14px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }
    th {
      background: #f14c3a;
      color: white;
    }
    tr:hover {
      background: #fff5f3;
    }
    .delete-btn {
      background: #e74c3c;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
    }
    .delete-btn:hover {
      background: #c0392b;
    }
    .img-preview {
      width: 60px;
      height: 60px;
      object-fit: contain;
      border-radius: 4px;
    }
    .status {
      padding: 10px;
      text-align: center;
      font-weight: bold;
    }
    .success { color: green; }
    .error { color: red; }
  </style>
</head>
<body>

  <header>
    Essie <span style="color:#333;">Jewelrys</span> Admin Panel
  </header>

  <div class="container">
<!-- ================== MAINTENANCE MODE ADMIN ================== -->
<div id="maintenanceAdmin" style="
    max-width:400px;
    margin:40px auto;
    padding:20px;
    background:#fff;
    border-radius:12px;
    box-shadow:0 6px 18px rgba(0,0,0,.08);
    text-align:center;
">
  <h2 style="margin-bottom:20px;">‚öôÔ∏è Maintenance Mode</h2>
  <p id="maintenanceStatus" style="margin-bottom:15px;font-weight:700;">Loading status...</p>
  <button id="toggleMaintenanceBtn" style="
      padding:12px 20px;
      border:none;
      border-radius:8px;
      background:#25D366;
      color:#fff;
      font-weight:700;
      cursor:pointer;
      font-size:1rem;
  ">Toggle Maintenance</button>
</div>

<!-- ================== WEBSITE LIVE PREVIEW ================== -->
<div class="card" id="livePreviewCard" style="margin-top:40px;">
  <h2 style="margin-bottom:15px;">üåê Website Live Preview</h2>
  
  <!-- Preview Iframe -->
  <div style="position:relative;border:1px solid #ddd;border-radius:12px;overflow:hidden;">
    <iframe id="websitePreview" src="index.html" 
      style="width:100%;height:600px;border:none;"></iframe>
    
    <!-- Refresh Button -->
    <button id="refreshPreview" style="
        position:absolute;
        top:10px;
        right:10px;
        padding:8px 12px;
        background:#25D366;
        color:#fff;
        font-weight:700;
        border:none;
        border-radius:6px;
        cursor:pointer;
        z-index:10;
    ">Refresh</button>
  </div>
</div>
<!-- IMAGE UPLOAD -->
<div class="card">
  <h2>üì∏ Image Upload (Public Link)</h2>

  <input 
    type="file" 
    id="imageFile" 
    accept="image/*"
    onchange="previewBeforeUpload()"
  >

  <img 
    id="imagePreview"
    style="
      display:none;
      width:100%;
      max-height:240px;
      object-fit:cover;
      border-radius:12px;
      margin:15px 0;
    "
  >
<div id="imageLoader" class="image-loader"></div>
  <button class="btn-primary" onclick="uploadImage()">Upload Image</button>

  <input id="imageLink" readonly placeholder="Image URL">
</div>
<script>
const IMGBB_KEY="47f7dff148164ff31a5947e6ee635363";
async function uploadImage(){
  const file=imageFile.files[0];
  if(!file) return alert("Select image");
  const fd=new FormData();
  fd.append("image",file);
  const r=await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`,{method:"POST",body:fd});
  const d=await r.json();
  imageLink.value=d.data.url;
}
document.getElementById("imagePreview").style.display = "none";
</script>
<script>
function refreshPreview(){
  const iframe = document.getElementById("livePreview");
  iframe.src = iframe.src;
}
</script>
<script>
function previewBeforeUpload(){
  const file = document.getElementById("imageFile").files[0];
  const preview = document.getElementById("imagePreview");
  const loader = document.getElementById("imageLoader");

  if(!file){
    preview.style.display = "none";
    loader.style.display = "none";
    return;
  }

  loader.style.display = "block";
  preview.style.display = "none";

  const reader = new FileReader();
  reader.onload = e => {
    preview.src = e.target.result;
    preview.style.display = "block";
    loader.style.display = "none";
  };
  reader.readAsDataURL(file);
}
document.getElementById("imageLoader").style.display = "block";
document.getElementById("imageLoader").style.display = "none";
</script>
    <!-- Add New Product Form -->
    <div class="form-section">
      <h2>Add New Product</h2>
      <div id="status" class="status"></div>
      <form id="addProductForm">
        <div class="form-grid">
           <input type="text" id="shopName" placeholder="Shop Name" required>
          <input type="text" id="productName" placeholder="Product Name" required>
          <input type="number" id="price" placeholder="Current Price (sh)" required>
          <input type="number" id="oldPrice" placeholder="Old Price (optional)">
          <input type="number" id="discount" placeholder="Discount % (optional)">
          <input type="text" id="image" placeholder="Image URL" required>
          <input type="number" id="stock" placeholder="Stock Quantity" required>
<input type="text" id="phone" placeholder="Phone Number" required>
          <select id="category" required>
            <option value="">Select Category</option>
            <option>IPhone</option>
            <option>Samsung</option>
            <option>Laptops</option>
            <option>Charger</option>
            <option>Powerbank</option>
            <option>Earpod</option>
            <option>Watches</option>
            <option>Phonecase</option>
            <option>Smartwatch</option>
          </select>
        </div>
        <textarea id="description" placeholder="Product Description (optional)"></textarea>
        <button type="submit">Add Product</button>
      </form>
    </div>
<!-- Live Preview -->
<div id="preview" style="margin-top:20px; padding:15px; border:1px solid #ddd; border-radius:10px; background:#fff; display:flex; gap:15px; align-items:center;">
  <img id="previewImage" src="https://via.placeholder.com/100" alt="Image" style="width:100px; height:100px; object-fit:cover; border-radius:8px;">
  <div>
    <h4 id="previewName">Product Name</h4>
    <p id="previewPrice">Sh 0</p>
    <p id="previewOldPrice">Old Price: -</p>
    <p id="previewDiscount">Discount: -</p>
    <p id="previewStock">Stock: 0</p>
    <p id="previewPhone">Phone: N/A</p>
    <p id="previewDescription">Description: -</p>
  </div>
</div>
    <!-- Products List -->
    <div class="products-table">
      <h2 style="padding: 20px; background: #f8f8f8;">All Products</h2>
      <table id="productsTable">
        <thead>
          <tr>
            <th>Image</th>
            <th>Name</th>
            <th>Category</th>
            <th>Price</th>
            <th>Old Price</th>
            <th>Discount</th>
            <th>Stock</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <!-- Products will be loaded here -->
        </tbody>
      </table>
    </div>

  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"></script>

  <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { 
  getDatabase, 
  ref, 
  push, 
  onValue, 
  remove, 
  update 
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* =====================
   FIREBASE INIT
===================== */
const firebaseConfig = {
  apiKey: "AIzaSyBSvsfXPXdwN-rh2KWvV7urUl_aEuqdOuE",
  authDomain: "jordanshop-5f754.firebaseapp.com",
  projectId: "jordanshop-5f754",
  storageBucket: "jordanshop-5f754.firebasestorage.app",
  messagingSenderId: "99289233170",
  appId: "1:99289233170:web:5b67672a133d7ff677a5cb",
  measurementId: "G-MYHECRT82T"  
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* =====================
   DOM ELEMENTS
===================== */
const addForm = document.getElementById("addProductForm");
const statusEl = document.getElementById("status");
const tableBody = document.querySelector("#productsTable tbody");

const shopNameEl = document.getElementById("shopName");
const productNameEl = document.getElementById("productName");
const priceEl = document.getElementById("price");
const oldPriceEl = document.getElementById("oldPrice");
const discountEl = document.getElementById("discount");
const imageEl = document.getElementById("image");
const stockEl = document.getElementById("stock");
const phoneEl = document.getElementById("phone");
const categorySelect = document.getElementById("category");
const descriptionEl = document.getElementById("description");

/* =====================
   STATUS MESSAGE
===================== */
function showStatus(msg, error = false) {
  statusEl.textContent = msg;
  statusEl.className = "status " + (error ? "error" : "success");
  setTimeout(() => statusEl.textContent = "", 4000);
}

/* =====================
   ADD PRODUCT
===================== */
addForm.addEventListener("submit", async (e) => {
  e.preventDefault();

  if (!categorySelect.value) {
    return showStatus("Select a category", true);
  }

  const product = {
    shopName: shopNameEl.value.trim(),
    productName: productNameEl.value.trim(),
    name: `${productNameEl.value.trim()} ‚Äî ${shopNameEl.value.trim()}`,
    price: Number(priceEl.value),
    oldPrice: oldPriceEl.value ? Number(oldPriceEl.value) : null,
    discount: discountEl.value ? Number(discountEl.value) : null,
    image: imageEl.value.trim(),
    stock: Number(stockEl.value),
    phone: phoneEl.value.trim(),
    description: descriptionEl.value.trim() || "",
    createdAt: Date.now()
  };

  try {
    await push(ref(db, `catalogs/${categorySelect.value}`), product);
    showStatus("Product added successfully");
    addForm.reset();
    updatePreview();
  } catch (err) {
    showStatus(err.message, true);
  }
});

/* =====================
   LOAD PRODUCTS
===================== */
function loadProducts() {
  onValue(ref(db, "catalogs"), snapshot => {
    tableBody.innerHTML = "";

    if (!snapshot.exists()) {
      tableBody.innerHTML = `<tr><td colspan="9" style="text-align:center;">No products</td></tr>`;
      return;
    }

    snapshot.forEach(catSnap => {
      const category = catSnap.key;

      catSnap.forEach(itemSnap => {
        const item = itemSnap.val();
        const id = itemSnap.key;

        const price = item.price ? `UGX ${Number(item.price).toLocaleString("en-UG")}` : "UGX 0";
        const oldPrice = item.oldPrice ? `UGX ${Number(item.oldPrice).toLocaleString("en-UG")}` : "-";
        const discount = item.discount ? `${item.discount}%` : "-";

        tableBody.innerHTML += `
          <tr>
            <td>
              <img src="${item.image}" class="img-preview" onerror="this.src='https://via.placeholder.com/60'">
            </td>
            <td>
              <strong>${item.productName}</strong><br>
              <small>${item.shopName}</small>
            </td>
            <td>${category}</td>
            <td>${price}</td>
            <td>${oldPrice}</td>
            <td>${discount}</td>
            <td>${item.stock}</td>
            <td>${item.phone}</td>
            <td>
              <button onclick="editProduct('${category}','${id}')">‚úè Edit</button>
              <button class="delete-btn" onclick="deleteProduct('${category}','${id}')">üóë</button>
            </td>
          </tr>
        `;
      });
    });
  });
}

/* =====================
   DELETE PRODUCT
===================== */
window.deleteProduct = async (category, id) => {
  if (!confirm("Delete this product?")) return;

  try {
    await remove(ref(db, `catalogs/${category}/${id}`));
    showStatus("Product deleted");
  } catch (err) {
    showStatus(err.message, true);
  }
};

/* =====================
   EDIT PRODUCT
===================== */
window.editProduct = async (category, id) => {
  const productName = prompt("Product name:");
  const shopName = prompt("Shop name:");
  const price = prompt("Price:");
  const image = prompt("Image URL:");
  const stock = prompt("Stock quantity:");
  const phone = prompt("Phone number:");

  if (!productName || !shopName || !price || !image || !stock || !phone) return;

  try {
    await update(ref(db, `catalogs/${category}/${id}`), {
      productName,
      shopName,
      name: `${productName} ‚Äî ${shopName}`,
      price: Number(price),
      image,
      stock: Number(stock),
      phone
    });
    showStatus("Product updated");
  } catch (err) {
    showStatus(err.message, true);
  }
};

/* =====================
   LIVE PREVIEW
===================== */
const previewImage = document.getElementById("previewImage");
const previewName = document.getElementById("previewName");
const previewPrice = document.getElementById("previewPrice");
const previewOldPrice = document.getElementById("previewOldPrice");
const previewDiscount = document.getElementById("previewDiscount");
const previewStock = document.getElementById("previewStock");
const previewPhone = document.getElementById("previewPhone");
const previewDescription = document.getElementById("previewDescription");

function updatePreview() {
  previewImage.src = imageEl.value || "https://via.placeholder.com/100";
  previewName.textContent =
    productNameEl.value && shopNameEl.value
      ? `${productNameEl.value} ‚Äî ${shopNameEl.value}`
      : "Product Name ‚Äî Shop Name";
  previewPrice.textContent = priceEl.value ? `UGX ${Number(priceEl.value).toLocaleString("en-UG")}` : "UGX 0";
  previewOldPrice.textContent = oldPriceEl.value ? `Old Price: UGX ${Number(oldPriceEl.value).toLocaleString("en-UG")}` : "Old Price: -";
  previewDiscount.textContent = discountEl.value ? `Discount: ${discountEl.value}%` : "Discount: -";
  previewStock.textContent = stockEl.value ? `Stock: ${stockEl.value}` : "Stock: 0";
  previewPhone.textContent = phoneEl.value ? `Phone: ${phoneEl.value}` : "Phone: N/A";
  previewDescription.textContent = descriptionEl.value ? `Description: ${descriptionEl.value}` : "Description: -";
}

/* =====================
   PREVIEW LISTENERS
===================== */
[
  shopNameEl,
  productNameEl,
  priceEl,
  oldPriceEl,
  discountEl,
  imageEl,
  stockEl,
  phoneEl,
  descriptionEl
].forEach(el => el.addEventListener("input", updatePreview));

/* =====================
   START
===================== */
loadProducts();
updatePreview();
</script>
<!-- ================== FLASH SELLS ADMIN MODULE ================== -->
<div id="flashSellsAdmin" style="margin-top:40px;">
  <style>
    /* Scoped styles */
    #flashSellsAdmin .card {
      background:#fff;
      padding:20px;
      border-radius:12px;
      box-shadow:0 6px 18px rgba(0,0,0,.08);
      margin-bottom:30px;
    }
    #flashSellsAdmin .form-grid {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:12px;
    }
    #flashSellsAdmin input, #flashSellsAdmin textarea {
      padding:12px;
      border:1px solid #ddd;
      border-radius:6px;
      font-size:.95rem;
      width:100%;
    }
    #flashSellsAdmin textarea { resize:none; }
    #flashSellsAdmin button {
      margin-top:12px;
      padding:12px;
      border:none;
      border-radius:8px;
      background:#25D366;
      color:#fff;
      font-size:1rem;
      font-weight:700;
      cursor:pointer;
    }
    #flashSellsAdmin table {
      width:100%;
      border-collapse:collapse;
    }
    #flashSellsAdmin th, #flashSellsAdmin td {
      padding:12px;
      border-bottom:1px solid #eee;
      text-align:left;
    }
    #flashSellsAdmin th {
      background:#111;
      color:#fff;
    }
    #flashSellsAdmin img {
      width:60px;
      height:60px;
      object-fit:cover;
      border-radius:6px;
    }
    #flashSellsAdmin .delete {
      background:#e74c3c;
      padding:6px 10px;
      border-radius:6px;
      color:#fff;
      border:none;
      cursor:pointer;
    }
    /* Live preview card */
    #flashSellsAdmin #previewCard {
      max-width:320px;
      border-radius:14px;
      overflow:hidden;
      box-shadow:0 10px 25px rgba(0,0,0,.12);
    }
    #flashSellsAdmin #previewCard img {
      width:100%;
      height:220px;
      object-fit:cover;
    }
  </style>

  <!-- Add Product Form -->
  <div class="card">
    <h2>Add Flash Sell Product</h2>
    <form id="flashAddForm">
      <div class="form-grid">
        <input id="fName" placeholder="Product Name" required>
        <input id="fPrice" type="number" placeholder="Price (UGX)" required>
        <input id="fOldPrice" type="number" placeholder="Old Price (optional)">
        <input id="fDiscount" type="number" placeholder="Discount % (optional)">
        <input id="fStock" type="number" placeholder="Stock" value="0">
        <input id="fPhone" placeholder="Contact Phone">
        <input id="fImage" placeholder="Image URL" required>
      </div>
      <textarea id="fDescription" placeholder="Description (optional)"></textarea>
      <button type="submit">Add Product</button>
    </form>
  </div>

  <!-- Live Preview -->
  <div class="card">
    <h2>Live Preview</h2>
    <div id="previewCard">
      <img id="pImage" src="https://via.placeholder.com/320x220">
      <div style="padding:15px;">
        <h3 id="pName">Product Name</h3>
        <p id="pPrice" style="font-weight:700;color:#25D366">UGX 0</p>
        <p id="pOldPrice" style="text-decoration:line-through;color:#999;display:none"></p>
        <p id="pDiscount" style="color:#e67e22;display:none"></p>
        <p id="pStock" style="font-size:.9rem;color:#555">Stock: 0</p>
        <p id="pPhone" style="font-size:.9rem;color:#555">Phone: N/A</p>
        <p id="pDescription" style="font-size:.85rem;color:#666;margin-top:8px;display:none"></p>
      </div>
    </div>
  </div>

  <!-- Products Table -->
  <div class="card">
    <h2>All Flash Sells</h2>
    <table>
      <thead>
        <tr>
          <th>Image</th>
          <th>Name</th>
          <th>Price</th>
          <th>Old</th>
          <th>Discount</th>
          <th>Stock</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="flashTableBody"></tbody>
    </table>
  </div>
</div>

<script type="module">
import { ref, push, onValue, remove, getDatabase } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* ===== Use existing Firebase app ===== */
const db = window.db || getDatabase(); // assumes main admin panel has initialized Firebase
const flashRef = ref(db, "flashSells");

/* ===== Elements ===== */
const form = document.getElementById("flashAddForm");
const tableBody = document.getElementById("flashTableBody");

const nameInput = document.getElementById("fName");
const priceInput = document.getElementById("fPrice");
const oldPriceInput = document.getElementById("fOldPrice");
const discountInput = document.getElementById("fDiscount");
const stockInput = document.getElementById("fStock");
const phoneInput = document.getElementById("fPhone");
const imageInput = document.getElementById("fImage");
const descriptionInput = document.getElementById("fDescription");

const pImage = document.getElementById("pImage");
const pName = document.getElementById("pName");
const pPrice = document.getElementById("pPrice");
const pOldPrice = document.getElementById("pOldPrice");
const pDiscount = document.getElementById("pDiscount");
const pStock = document.getElementById("pStock");
const pPhone = document.getElementById("pPhone");
const pDescription = document.getElementById("pDescription");

/* ===== Live Preview ===== */
function updatePreview() {
  pImage.src = imageInput.value || "https://via.placeholder.com/320x220";
  pName.textContent = nameInput.value || "Product Name";
  pPrice.textContent = `UGX ${priceInput.value ? Number(priceInput.value).toLocaleString("en-UG") : 0}`;

  if(oldPriceInput.value) { pOldPrice.style.display="block"; pOldPrice.textContent=`UGX ${Number(oldPriceInput.value).toLocaleString("en-UG")}`; }
  else { pOldPrice.style.display="none"; }

  if(discountInput.value) { pDiscount.style.display="block"; pDiscount.textContent=`Discount: ${discountInput.value}%`; }
  else { pDiscount.style.display="none"; }

  pStock.textContent = `Stock: ${stockInput.value || 0}`;
  pPhone.textContent = `Phone: ${phoneInput.value || "N/A"}`;

  if(descriptionInput.value) { pDescription.style.display="block"; pDescription.textContent=descriptionInput.value; }
  else { pDescription.style.display="none"; }
}
[nameInput, priceInput, oldPriceInput, discountInput, stockInput, phoneInput, imageInput, descriptionInput].forEach(el=>el.addEventListener("input", updatePreview));

/* ===== Add Product ===== */
form.addEventListener("submit", async e=>{
  e.preventDefault();
  const data = {
    name: nameInput.value.trim(),
    price: Number(priceInput.value),
    oldPrice: oldPriceInput.value ? Number(oldPriceInput.value) : null,
    discount: discountInput.value ? Number(discountInput.value) : null,
    stock: stockInput.value ? Number(stockInput.value) : 0,
    phone: phoneInput.value.trim() || "",
    image: imageInput.value.trim(),
    description: descriptionInput.value.trim() || "",
    createdAt: Date.now()
  };
  await push(flashRef, data);
  form.reset();
});

/* ===== Load Products ===== */
onValue(flashRef, snap=>{
  tableBody.innerHTML = "";
  if(!snap.exists()) {
    tableBody.innerHTML = `<tr><td colspan="7">No products found</td></tr>`;
    return;
  }
  snap.forEach(child=>{
    const item = child.val();
    const id = child.key;
    tableBody.innerHTML+=`
      <tr>
        <td><img src="${item.image}" onerror="this.src='https://via.placeholder.com/60'"></td>
        <td>${item.name}</td>
        <td>UGX ${item.price.toLocaleString("en-UG")}</td>
        <td>${item.oldPrice ? "UGX "+item.oldPrice.toLocaleString("en-UG") : "-"}</td>
        <td>${item.discount ?? "-"}%</td>
        <td>${item.stock}</td>
        <td><button class="delete" onclick="deleteFlashItem('${id}')"><i class="fas fa-trash"></i></button></td>
      </tr>
    `;
  });
});

/* ===== Delete Product ===== */
window.deleteFlashItem = async id=>{
  if(confirm("Delete this product?")) {
    await remove(ref(db, `flashSells/${id}`));
  }
};
</script>
<script type="module">
import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* ===== Use existing Firebase DB or fallback ===== */
let db;
try {
  db = window.db || getDatabase(); // use existing or create a default
} catch (err) {
  console.error("Firebase Database not initialized:", err);
  throw new Error("Firebase DB not initialized. Make sure your admin panel includes Firebase.");
}

/* ===== Elements ===== */
const statusText = document.getElementById("maintenanceStatus");
const toggleBtn = document.getElementById("toggleMaintenanceBtn");

/* ===== Firebase Reference ===== */
const maintenanceRef = ref(db, "maintenance");

/* ===== Listen to maintenance node ===== */
let currentStatus = false; // default
onValue(maintenanceRef, snapshot => {
  currentStatus = snapshot.exists() ? snapshot.val() : false;
  statusText.textContent = currentStatus ? "Maintenance Mode: ON" : "Maintenance Mode: OFF";
  toggleBtn.style.background = currentStatus ? "#e74c3c" : "#25D366";
  toggleBtn.textContent = currentStatus ? "Turn OFF" : "Turn ON";
});

/* ===== Toggle Function ===== */
toggleBtn.addEventListener("click", async () => {
  try {
    await set(maintenanceRef, !currentStatus); // flip the value
  } catch (err) {
    console.error("Failed to update maintenance status:", err);
    alert("Failed to update maintenance status. Check console for details.");
  }
});
</script>
<!-- ================== ADMIN LOGIN MODAL ================== -->
<div id="adminLoginModal" style="
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:url('https://i.ibb.co/Vpjch1MK/1000766906.jpg') no-repeat center center/cover;
    display:flex;
    justify-content:center;
    align-items:center;
    z-index:9999;
">
  <!-- semi-transparent overlay to darken background -->
  <div style="
      position:absolute;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background:rgba(0,0,0,0.5);
  "></div>

  <div id="adminLoginCard" style="
      position:relative; /* to stay above overlay */
      background:#fff;
      padding:30px 25px;
      border-radius:12px;
      box-shadow:0 6px 18px rgba(0,0,0,.25);
      width:100%;
      max-width:400px;
      text-align:center;
      z-index:10;
  ">
    <h2 style="margin-bottom:25px;font-weight:700;font-size:1.6rem;color:#111;">Admin Login</h2>

    <input type="email" id="adminEmail" placeholder="Email" style="
        width:100%;
        padding:12px;
        margin-bottom:15px;
        border:1px solid #ddd;
        border-radius:6px;
        font-size:.95rem;
    ">
    <input type="password" id="adminPassword" placeholder="Password" style="
        width:100%;
        padding:12px;
        margin-bottom:15px;
        border:1px solid #ddd;
        border-radius:6px;
        font-size:.95rem;
    ">

    <button id="loginBtn" style="
        width:100%;
        padding:12px;
        border:none;
        border-radius:8px;
        background:#25D366;
        color:#fff;
        font-size:1rem;
        font-weight:700;
        cursor:pointer;
    ">Login</button>

    <p id="loginError" style="color:red;text-align:center;margin-top:12px;display:none;"></p>
  </div>
</div>

<script type="module">
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

/* Use existing Firebase Auth */
const auth = window.auth || getAuth();

const modal = document.getElementById("adminLoginModal");
const loginBtn = document.getElementById("loginBtn");
const emailInput = document.getElementById("adminEmail");
const passwordInput = document.getElementById("adminPassword");
const loginError = document.getElementById("loginError");

/* Show login modal only if user not signed in */
onAuthStateChanged(auth, user => {
  if(user){
    modal.style.display = "none";
  } else {
    modal.style.display = "flex";
  }
});

loginBtn.addEventListener("click", async () => {
  const email = emailInput.value.trim();
  const password = passwordInput.value;

  if (!email || !password) {
    loginError.textContent = "Please enter email and password.";
    loginError.style.display = "block";
    return;
  }

  try {
    await signInWithEmailAndPassword(auth, email, password);
    loginError.style.display = "none";
    modal.style.display = "none"; // hide modal after login
  } catch (error) {
    loginError.textContent = error.message;
    loginError.style.display = "block";
  }
});
</script>
<script>
/* ===== Elements ===== */
const previewFrame = document.getElementById("websitePreview");
const refreshBtn = document.getElementById("refreshPreview");

/* ===== Refresh Function ===== */
refreshBtn.addEventListener("click", () => {
  // Reload the iframe
  previewFrame.src = previewFrame.src;
});
</script>
</body>
</html>
